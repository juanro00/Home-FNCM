/*!
* jquery.counterup.js 1.0
*
* Copyright 2013, Benjamin Intal http://gambit.ph @bfintal
* Released under the GPL v2 License
*
* Date: Nov 26, 2013
*/(function($, window) { // Added `window` to ensure `setTimeout` is recognized
  "use strict";
  $.fn.counterUp = function(options) {
    var settings = $.extend({time: 400, delay: 10}, options);
    return this.each(function() {
      var $this = $(this);

      var counterFunc = function() {
        if ($this.data("counterup-nums")) return; // Prevent reinitialization

        var numbers = [];
        var divisions = settings.time / settings.delay;
        var num = $this.text().replace(/,/g, "");
        var isFloat = /^[0-9]+\.[0-9]+$/.test(num);
        var decimalPlaces = isFloat ? (num.split(".")[1] || []).length : 0;

        for (var i = divisions; i >= 1; i--) {
          var newNum = parseFloat(num / divisions * i).toFixed(decimalPlaces);
          if (!isFloat) newNum = parseInt(newNum);
          numbers.unshift(newNum);
        }

        $this.data("counterup-nums", numbers);
        $this.text("0");

        var updateCounter = function() {
          $this.text($this.data("counterup-nums").shift());
          if ($this.data("counterup-nums").length) {
            window.setTimeout($this.data("counterup-func"), settings.delay);
          } else {
            $this.data("counterup-nums", null);
            $this.data("counterup-func", null);
          }
        };

        $this.data("counterup-func", updateCounter);
        window.setTimeout($this.data("counterup-func"), settings.delay);
      };

      $this.waypoint(counterFunc, {offset: "100%", triggerOnce: true});
    });
  };
})(jQuery, window); // Passed `window` as an argument
